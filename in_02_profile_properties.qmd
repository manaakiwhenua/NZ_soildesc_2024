# Profile properties

```{r}
library(dplyr)
library(tibble)
library(gt)
library(gtExtras)
```

Intro/context statement goes here

## NZSC Family

Intro, why the Family is useful, reference to webb and lilburne, things of that nature

### Soil Profile Material

The soil profile material code comprises a brief summary of the overall character of the profile, in particular its mineral and stone content and major erosional/depositional character. Some information on the likely range of bulk density values is implicit.

@tbl-in-pmat below defines the available classes and should be used as a key. For Organic soils, skip the 'M' codes and start at [**Sl**]{style="color: red"}.

Applying the key accurately requires familiarity with the major NZSC diagnostic criteria. Links to glossary definitions are provided below, but the source material [@hewitt2010] should also be consulted.

```{r}
#| label: tbl-in-pmat
#| tbl-cap: "Soil Profile Material"

dat_in_pmat <-
  tribble(~Code, ~Name, ~ Description,
          'Mf', 'Fragmental', 'Gravels and/or boulders with minimal fine earth from within 20 cm to > 60 cm depth',
          'Ml' ,'Lithic', 'Other soils with a coherent- or shattered [lithic contact](LINKME) within 45 cm',
          'Mp', 'Paralithic', 'Other soils with a [paralithic contact](LINKME) within 45 cm',
          'Mt', 'Tephric', 'Other soils with at least 30 cm of [tephric soil material](LINKME) within 100 cm',
          'Mr', 'Rounded-stony', 'Other soils with ≥ 35% by volume [rounded or sub-rounded](LINKME) gravel and/or boulders from within 45 cm to > 100 cm.',
          'Ma', 'Angular-stony', 'Other soils with ≥ 35% by volume [angular or sub-angular](LINKME) gravel and/or boulders from within 45 cm to > 100 cm.',
          'Mm', 'Moderately deep on rock', 'Other soils with a lithic or paralithic contact at < 100 cm.',
          'Mg', 'Moderately deep on gravel', 'Other soils with ≥ 35% by volume rounded or sub-rounded gravel and/or boulders from within 45--90 cm, extending continuously to 100 cm with a cumulative thickness of ≥ 50 cm (unless over rock).',
          'Md', 'Stoneless', 'Other soils with weighted average < 3% gravel by volume in the top 100 cm.',
          'Ms', 'Stony', 'Other mineral soils.',
          'Sl', 'Organic-lithic', 'Organic soils with a coherent- or shattered lithic contact within 45 cm.',
          'Sp', 'Organic-paralithic', 'Other organic soils with a paralithic contact within 45 cm.',
          'Sd', 'Organic-deep', 'Other organic soils with continuous peat throughout the top 100 cm.',
          'So', 'Organic-other', 'Other organic soils.')

tbl_in_pmat <- gt(dat_in_pmat) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~pct(20))

tbl_in_pmat

```

### Rock Class of stone and bedrock

Rock class in an NZSC Family context uses the lithology codes in @tbl-ss-pm, with specific restrictions around how they are applied to the whole profile:

-   Rock class is only defined in reference to stones \> 2 mm and bedrock (where encountered within 100 cm). The rock class of the fine earth fraction is accounted for elsewhere.
-   The 'deep and stoneless' classes ([**Mt**]{style="color: red"}, [**Md**]{style="color: red"}, [**So**]{style="color: red"} and [**Sd**]{style="color: red"}) can still have up to a total of \< 3% by volume stones in the top 100 cm.
-   Include pumice in rock class only where pumice strength is more than 'extremely weak' [@lynn1991, p. 10] - i.e., it can only be broken by hand with difficulty. If the pumice's lithology is uncertain, use the dominant lithology of the volcano of origin (e.g. [**Rh**]{style="color: red"} in the Taupō Volcanic Centre and [**An**]{style="color: red"} around Taranaki).
-   Where in-profile stone lithology contrasts with bedrock lithology, two codes separated by '[**/**]{style="color: red"}' can be used e.g. [**Sc/Gw**]{style="color: red"}.
-   Where two lithologies are close to co-dominant in a stony profile, two codes separated by '[**+**]{style="color: red"}' can be used e.g. [**An+Rh**]{style="color: red"}.
-   More complicated combinations are not allowed, e.g. no [**An+Rh/Gw**]{style="color: red"}.

[might need an ok/not ok table here, although what would actually be better is separating profile and bedrock rock class entirely]{style="background-color:lightgreen"}

### Rock class of fines

The same rock class codes in @tbl-ss-pm can be applied to report the dominant lithology of the fine earth (\< 2 mm) fraction of the full profile. Again, some rules apply:

-   [**Sd**]{style="color: red"} soils and [**Mf**]{style="color: red"} soils effectively have no fine earth fraction. Leave the property undefined.
-   Where a lithological discontinuity exists in the profile, two codes separated by '[**/**]{style="color: red"}' can be used e.g. [**Sc/Gw**]{style="color: red"}.
-   Where two lithologies are close to co-dominant, two codes separated by '[**+**]{style="color: red"}' can be used e.g. [**An+Rh**]{style="color: red"}.
-   More complicated combinations are not allowed, e.g. no [**An+Rh/Sm+Ss/Gw**]{style="color: red"}.

## Drainage

Profile drainage is determined by the depth to the most poorly-drained horizon (see @tbl-in-intdrng). This horizon may be perched.



@tbl-in-pdrng describes some potential additional signifier of drainage condition that might be considered. These may be useful when estimating drainage in a new landscape that has not yet been examined in detail.

```{r}
#| label: tbl-in-pdrng
#| tbl-cap: "Profile drainage signifiers"
#| classes : no-stripe

dat_hr_colorshort <-
  tribble(~Code, ~Name, ~relel, ~Landform, ~Slope, ~Veg, ~Other, 
         'VP', 'Very poor', 'Very low (0-1m)', 'Waning/minimal/enclosed flats and depressions', 'Low-slope or level ground', 'Wetland plants', 'Persistent surface water ponding or seeps nearby',
         'PO', 'Poor', 'Low relative elevation (0-10m)', 'Waning/minimal slopes and flats', 'Low-slope or level ground', 'Wetland plants', 'Seasonal ponding or seeps nearby',
         'SP', 'Slightly Poor', 'Variable relative elevation', 'Flat to moderate slopes', '', '', '',
         'IP', 'Imperfect', 'Variable relative elevation', 'Flat to moderate slopes', '', '', '')

tbl_hr_colorshort <- gt(dat_hr_colorshort) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_colorshort

```


## Permeability
