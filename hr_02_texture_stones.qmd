---
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse) 
library(gt)
library(gtExtras)
library(ggtern)
library(extrafont)
loadfonts(quiet = TRUE)
```

# Soil texture and particle size distribution

The particle size distribution in a soil extends from the finest mineral nanomaterials up to large boulders. Mineral particles are grouped into size classes for reporting. The fine fraction (≤ 2 mm) is considered separately to the coarse, and its compositional information is called 'soil texture'.

## Fine fraction

### Field textures and laboratory measurements

Texture can be measured both in the field by working a moist sample in the hand, and in the laboratory. These measures are correlated but are not identical.

Hand texture is a rapid method that can reveal information about clay mineral type, angularity or roundedness in the sand and silt fractions, organic matter content, and the influence of secondary minerals, as well as the mineral particle size distribution itself. However, the method has precision limits and requires careful user calibration.

Laboratory particle size measurement can involve measurements of particle shape and mineralogy but these methods are labour-intensive and generally confined to a research context. High-throughput analyses confine themselves to assessment of particle size alone, making assumptions about shape and mineralogy (see Loveland and Whalley, 2000, for a more detailed discussion.) 

Particle size analysis usually involves removal of organic materials and soluble minerals as well as more aggressive aggregate dispersion using shaking and chemical solutions. Following dispersion, measurements of 3-8 specific size fractions are recorded. These data are then summarised into a three part sand/silt/clay composition.

The boundaries of these three size fractions are somewhat unsettled. The silt-clay boundary aligns with some major changes in particle properties; chief among them the emergence of electrostatic behaviour in the clay fraction. The sand/silt boundary can range from 0.02-0.063um. See @tbl-hr-texcompar for the fractions used in NZ and other jurisdictions.

```{r}
#| label: tbl-hr-texcompar
#| tbl-cap: "Size fraction limits: New Zealand and elsewhere" 
#| classes : no-stripe

# can also build out to coarse/med/fine sand and fine clay etc

dat_hr_texcompar <-
  tribble(~Jurisdiction, ~Sand, ~Silt, ~Clay,
          'New Zealand, UK', '< 2.0 mm',  '< 0.06 mm', '< 0.002 mm',
          'Australia  ',     '< 2.0 mm',  '< 0.02 mm', '< 0.002 mm',
          'USA, Canada',     '< 2.0 mm',  '< 0.05 mm', '< 0.002 mm',
          'Global',          '< 2.0 mm', '< 0.063 mm', '< 0.002 mm')

tbl_hr_texcompar <- gt(dat_hr_texcompar) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Jurisdiction ~pct(40))
  
tbl_hr_texcompar


```

### Texture classes {#sec-hr-tex}

Sand/silt/clay compositional data can be displayed on a triangle plot (see @fig-texture-tri), and domains within the plot, or 'texture classes', are labelled for ease of communication. It is important to remember that these classes do not have sharp changes in hand-feel texture at their boundaries.

```{r}
#| label: fig-texture-tri
#| fig-cap: "New Zealand Soil Texture Triangle"

nztt_dat <- readRDS(file.path('data', 'NZTT.RDS')) %>% 
  mutate(GROUP = case_match(CODE, 
                            c('S', 'LS')        ~ 'Sandy',
                            c('SL', 'SC', 'CL') ~ 'Loamy',
                            c('Z', 'ZL', 'LZ')  ~ 'Silty',
                            c('ZC', 'LC', 'C')  ~ 'Clayey'))

nztt_labels <- readRDS(file.path('data', 'NZTT_LABELS.RDS'))

nz_tri <-
  ggtern(data = nztt_dat, aes(x = SAND, y = CLAY, z = SILT)) +
  geom_polygon(aes(group = NAME, fill = GROUP),
               colour = 'grey50', alpha = 0.7) +
  geom_text(data = nztt_labels, aes(label = cat_texture_code), 
            colour = 'grey30') +
  scale_fill_manual(values = c('Sandy' = '#ffffb3', 'Silty' = '#bebada',
                               'Loamy' = '#8dd3c7', 'Clayey' = '#fb8072')) +
  theme_showarrows() +
  theme_nomask() +
  labs(x = 'Sand %', y = 'Clay %', z = 'Silt %', fill = 'Texture Group') +
  theme(panel.border = element_rect(colour = 'grey40'),
        panel.background = element_rect(fill = NA),
        tern.panel.grid.ontop = FALSE,
        panel.grid = element_line(colour = 'grey90'),
        text = element_text(family = "Ebrima"),
        legend.key = element_blank(),
        tern.axis.title.show = FALSE,
        legend.position = 'right')

nz_tri
```

```{r}
#| label: tbl-texture-tri
#| tbl-cap: "New Zealand Texture Triangle class names and compositional limits"
#| classes : no-stripe

tbl_hr_textri <- nztt_labels |>
  dplyr::select(matches('cat_'), matches('txt_'), -cat_texture_group) |>
  dplyr::select(cat_texture_code, cat_texture_name, everything()) |>
  gt() |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(cat_texture_code ~pct(20), cat_texture_name ~ pct(20)) |>
  cols_label(cat_texture_name = 'Name', cat_texture_code = 'Code',
             txt_clay_range = 'Clay range',
             txt_silt_range = 'Silt range',
             txt_sand_range = 'Sand range')
  
tbl_hr_textri

```

#### Sand modifiers

Hand-texture classes can be accompanied by additional information about the sand fraction. These codes can be appended to a texture class as a prefix, e.g. [**(K)LS**]{style="color: red"} for coarse loamy sand.

Note that appreciable coarse sand in a sample leads to underestimates of clay content in hand texturing.

```{r}
#| label: tbl-hr-sandquals
#| tbl-cap: "Sand fraction qualifiers"
#| classes : no-stripe

dat_hr_sandquals <-
  tribble(~Code, ~Name, ~Description,
         'K', 'Coarse', 'Sand is dominantly 2.0 - 0.6 mm',
         'M', 'Medium', 'Sand is dominantly 0.6 - 0.2 mm',
         'F', 'Fine',   'Sand is dominantly 0.2 - 0.06 mm')

tbl_hr_sandquals <- gt(dat_hr_sandquals) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_sandquals

```

#### Organics modifiers

Hand-texture classes can also be modified to express the presence of elevated soil organic matter and its degree of decomposition (where it remains below the cutoff for organic soil materials). These codes can be appended to a texture class as a suffix, e.g. [**SL(T)**]{style="color: red"} for slightly organic sandy loam, or [**SL(TF)**]{style="color: red"} for slightly organic, fibric sandy loam.

Either of the organic matter abundance qualifiers can be used to signify the 'peaty topsoil' NZSC diagnostic.

```{r}
#| label: tbl-hr-orgmquals
#| tbl-cap: "Organic matter qualifiers - amount"
#| classes : no-stripe

dat_hr_orgmquals <-
  tribble(~Code, ~Name, ~Description,
         'T', 'Slightly organic', '17-30% organic matter',
         'P', 'Moderately organic', '30-50% organic matter')

tbl_hr_orgmquals <- gt(dat_hr_orgmquals) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_orgmquals

```

```{r}
#| label: tbl-hr-orgmdec
#| tbl-cap: "Organic matter qualifiers - decomposition"
#| classes : no-stripe

dat_hr_orgmdec <-
  tribble(~Code, ~Name, ~Description,
         'F', 'Fibric', 'Organic matter weakly decomposed and dominated by visible plant remains',
         'M', 'Mesic', 'Organic matter moderately decomposed, some visible plant structures but mostly amorphous',
         'H', 'Humic', 'Organic matter no longer identifiable, minimal fibre content')

tbl_hr_orgmdec <- gt(dat_hr_orgmdec) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_orgmdec
```

### Particle size estimate

Estimating particle size in the field involves compensating for the influences described above and arriving at estimates of sand and clay content (silt can be determined by difference). Record estimated clay and sand to the nearest whole percent. Optionally, add a separate error estimate (+/- x%) as an expression of confidence.

## Coarse fraction {#sec-hr-stone}

The mineral fraction \> 2 mm is still part of the soil macrofabric, but for practical reasons is measured separately. These rock fragments can be classified on a size scale with ranges of $2*10^n - 6*10^n$, as follows @tbl-hr-rockfrsz.

```{r}
#| label: tbl-hr-rockfrsz
#| tbl-cap: "Coarse fragment Size classes"
#| classes : no-stripe

dat_hr_rockfrsz <-
  tribble(~Code, ~Name, ~Description,
         1, 'Fine gravel',    '2 - 6 mm',
         2, 'Medium gravel',  '6 - 20 mm',
         3, 'Coarse gravel',  '20 - 60 mm',
         4, 'Cobbles',        '60 - 200 mm',
         5, 'Stones',         '200 - 600 mm',
         6, 'Boulders',       '600 - 2000 mm', 
         7, 'Large boulders', '>2000 mm') 

tbl_hr_rockfrsz <- gt(dat_hr_rockfrsz) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_rockfrsz
```

-   For rapid assessment, estimate total rock fragment abundance as an integer percentage, recording [**0%**]{style="color: red"} when confirming absence. 
-   For routine assessment, split abundance over the size classes in @tbl-hr-rockfrsz.
-   For detailed assessments, append further information on dominant fragment lithology using the codes in @tbl-ss-pm and shape using the codes in @tbl-hr-rockfrshp below.

```{r}
#| label: tbl-hr-rockfrshp
#| tbl-cap: "Coarse fragment shape classes"
#| classes : no-stripe

dat_hr_rockfrshp <-
  tribble(~Code, ~Name, ~Description,
         'R', 'Rounded',   'Rock fragments considerably smoothed by transport processes',
         'A', 'Angular', 'Rock fragments with little smoothing by transport processes',
         'M', 'Mixed', 'Both rounded and angular fragments mixed together',) 

tbl_hr_rockfrshp <- gt(dat_hr_rockfrshp) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_rockfrshp
```

## Other coarse soil components

### Natural {#sec-hr-nonrock}

Biologically-derived coarse materials can alter the soil's water holding capacity and other parameters just as rock fragments can, although in general they can themselves hold more water. They will also break down faster.

Where present in significant amounts, record natural non-rock fragments as a percentage abundance of the following:

```{r}
#| label: tbl-hr-nonrock
#| tbl-cap: "Non-rock fragment types"
#| classes : no-stripe

dat_hr_nonrock <-
  tribble(~Code, ~Name, ~Description,
         'S', 'Shell',    'Seashells or chitinous material',
         'B', 'Bone',     'Skeletal fragments',
         'T', 'Timber',   'Dead wood from trees and shrubs, coarse roots',
         'C', 'Charcoal', 'Burnt timber fragments')

tbl_hr_nonrock <- gt(dat_hr_nonrock) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_nonrock

```

### Artefacts

Artefacts can both function like rock fragments and signify strong human influence on the soil profile. 

Where present in significant amounts, record artefact fragments as a percentage abundance of the categories in @tbl-hr-artefacts. Where further details are required, describe the materials present in free-text notes.

```{r}
#| label: tbl-hr-artefacts
#| tbl-cap: "Artefact types"
#| classes : no-stripe

dat_hr_artefs <-
  tribble(~Code, ~Name, ~Description,
         'As', 'Asphalt',  'Ashpalt and other bitumen-containing materials',
         'Br', 'Brick',    'Fired clay building materials, usually unglazed',
         'Cr', 'Ceramic',  'Fired clay objects, usually glazed',
         'Ce', 'Concrete', 'Concrete materials',
         'Gl', 'Glass',    'Fragments from windows, containers, etc',
         'Tn', 'Textiles - natural', 'Fabrics and carpets made from e.g. wool',
         'Tx', 'Textiles - artificial', 'Fabrics derived from or dominated by plastics',
         'Mt', 'Metals', 'Refined ore products',
         'Ms', 'Mine Spoil', 'Materials leftover from ore processing activities',
         'Ws', 'Wastes', 'Other domestic or commercial rubbish')
         # still working on this - could split into wastes vs e.g. items of arch. interest)

tbl_hr_artefs <- gt(dat_hr_artefs) |>
  tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))
  
tbl_hr_artefs

```
