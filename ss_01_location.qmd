# Location

```{r}
library(dplyr)
library(tibble)
library(gt)
library(gtExtras)
```

A soil description is essentially useless without a confident location. Confidence is supported by clear communication about equipment, datum and coordinate reference system, measurement units, and expected error.

## Absolute location

### Equipment

Use a GNSS (Global Navigation Satellite System) with an expected horizontal accuracy of ± 3 m or better. Some applications may require centimetre accuracy. Record sensor type against the schema in @tbl-ss-locsrc.

```{r}
#| label: tbl-ss-locsrc
#| tbl-cap: "Location data source"

dat_ss_elevsrc <-
  tribble(~Code, ~Name, ~Description,
          'GS', 'Single-band GNSS', 'Satellite based location, single band',
          'GM', 'Multi-band GNSS', 'Satellite based location, multiple band',
          'GR', 'Differential GNSS', 'Satellite based location, on-ground correction',
          'LM', 'Multi-sensor', 'Combined GNSS and other location data e.g. mobile phone towers, wifi routers and nearby devices.',
          'NO', 'None', 'Location determined manually.')

tbl_ss_elevsrc <- gt(dat_ss_elevsrc) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20), Name ~ pct(20))

tbl_ss_elevsrc

```

::: callout-tip
Multi-constellation GNSS is not the same as multi-band GNSS. The former signifies access to multiple location satellite networks operated by various parties, e.g. GPS (USA), Galileo (EU), BeiDou (China). This can improve signal *consistency* due to having access to more total satellites, but not necessarily overall accuracy.

Multi-band GNSS involves receiving signals from location satellites on multiple frequency bands. The extra data from each satellite can significantly improve connection reliability and accuracy, particularly when open sky is restricted by rough terrain, dense vegetation or poor weather.
:::

::: callout-warning
Most consumer electronic devices capable of reporting location will be [LM]{.ceg} type by default, unless using an app that actively forces a GNSS-only connection. At the time of writing, most of these devices can still only report [GS]{.ceg} quality data with such apps due to hardware limitations. As such, these devices can be extremely accurate in urban areas and much less so elsewhere.
:::

::: callout-note
Estimating location manually using e.g. topographic maps and orienteering methods remains an option, but should usually be considered a last resort.
:::

### Elevation measurement {#sec-loc-abs-elev}

Parts of New Zealand still lack highly accurate elevation data. Elevation can also change suddenly in response to major tectonic activity. Record the elevation data source used against the schema in @tbl-ss-locsrc, or use one of the additional options in @tbl-ss-elevsrc below.

```{r}
#| label: tbl-ss-elevsrc
#| tbl-cap: "Elevation data sources"

dat_ss_elevsrc <-
  tribble(~Code, ~Name,
          'E', 'Estimate',
          'A', 'Measured by a calibrated altimeter',
          'M', 'Interpolated from contour map with interval of ≤ 20 m, or extracted from similar-quality Digital Elevation Model (DEM)',
          'D',  'Extracted from high-accuracy DEM (Lidar or similar)')


tbl_ss_elevsrc <- gt(dat_ss_elevsrc) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20))

tbl_ss_elevsrc

```

The [M]{.ceg} code should be used for most non-Lidar DEMs, as those available for public use were constructed from interpolated contour data or other methods with comparable vertical accuracy [see @barringer2002; @uuemaa2020] .

Where the [A]{.ceg} code is used, the time and location of the most recent altimeter calibration should be noted.

::: callout-note
Where DEMs are used, they should be as contemporary as possible; New Zealand’s rate of landscape evolution is relatively high and these data sources will become less reliable with age. DEMs more than 20 years old should be accompanied by a vertical error estimate adjusted upwards for age.
:::

### Coordinate reference system (CRS)

Record X and Y location coordinates using New Zealand Transverse Mercator (EPSG:2193). For Z coordinates (elevation), use the New Zealand Vertical Datum 2016 (EPSG:1169).

X and Y precision does not need to exceed 1 m for pits, or 0.1 m for cores and auger holes. Z precision will rarely need to exceed 0.1 m.

Example: [1586090E, 5405722N (462 m)]{.ceg}

```{r}
# map goes here - its the centre of NZ

```

::: callout-warning
Many location sensors default to the global longitude-latitude based WGS84 datum (EPSG:4326). As a global system, its maximum accuracy is around 3 m, and coordinate accuracy also degrades over time due to continental drift. This is compensated for using a date-based 'epoch' adjustment. Because of these limitations, WGS84 should only be used when reconciling data from multiple locations on a global scale.
:::

::: callout-warning
Alternate geocoding systems involving e.g. text-based encoding or nested hashes should be avoided during fieldwork. The systems are often proprietary, sometimes prone to ambiguity or edge-case errors, and at their core often wrap around WGS84 anyway. They may still be useful during data analysis.
:::

### Expected Error

Expected horizontal error can be automatically reported by equipment, or estimated. When estimating, record in meters with a maximum precision of 0.01 (1 cm) e.g. [± 5.1 m]{.ceg}. Record expected vertical elevation error separately in the same units, as it will differ.

::: callout-note
Site location data quality can often be improved by revising the locations in GIS after fieldwork. Where corrections are made, expected error from the measuring instrument should be overridden with a new manual estimate of expected error.
:::

### Temporal {#sec-ss-dt}

Record the date of observation using the ISO 8601 standard, [YYYY-MM-DD]{.ceg} [@internationalorganizationforstandardization]. Time is not essential but may be useful for correlating site descriptions with photographs.

## Relative location

Absolute locations are enhanced by information about what is nearby. This context is useful for checking that a site's coordinates are correct and for revisiting a site in future.

### Relative elevation

Elevation above the nearest down-slope drainage (open/flowing water, swampy ground, or a closed depression) is useful for landscape interpretations. The data can also be used to group site descriptions, for instance when identifying sets of related terraces along river systems. The drainage feature to record against must be identified by tracing a path down-slope from the observation point, and may be far from the point of observation. As such, it will normally be more efficient to estimate this parameter after fieldwork using elevation and imagery data.

Record relative elevation in meters, with a precision of no more than 0.01 (1 cm).

::: callout-note
With sufficiently detailed inputs, a Relative Elevation Model (REM) can be constructed to estimate this parameter, but will need to be ground-truthed.
:::

### Triangulating off local features

Absolute location data can be backed up by measuring to nearby permanent or long-term features. This is particularly useful for relocating long-term monitoring plots. For this to work well, features should be within \~50 m of the target location and sufficiently sturdy to last until at least the next expected visit. Examples include fencelines, buildings, roads, and rock outcrops.

For single-point sites, measure distance and direction using a tape and compass. Accuracy is improved by measuring to two or more features. For plot-based sites, one can measure from at least two corners to the target feature. Photographing the point/plot and reference points together is also useful.

[add a diagram here]{style="background-color:lightgreen"}

### Long-form descriptions

For observation points that will be revisited, record practical information about how to return. This may include landholder contact details and records of previous interactions, notes about track conditions, locked gates, and potential hazards like water crossings. Spatial data recording the track from the nearest public road to the target location is particularly valuable.

### Administrative location

Tagging sites with their administrative region(s) can help with discoverability (searching and filtering) in databases, and simplify information security and privacy arrangements. This does not need to be done in the field, provided accurate locations are recorded.

In New Zealand, relevant boundaries include Regional Council [@statsnz] and Territorial Authority (District Council, Stats NZ [-@statsnza]) areas. Note that these boundaries are periodically updated so need to be related to date of observation.

### Temporal

Relative temporal data focuses on time since significant soil-influencing events. These can provide context for the parameters recorded, and some are especially useful when interpreting laboratory results.

Only include recent events directly affecting the site. 'Recent' is a relatively flexible concept which highlights the reasons some parameters observed might be locally unusual. Some of these events recur regularly (e.g. tillage) so only need to be noted if very recent (e.g. previous week).

If the time since the event is known with certainty, also record as number of days since the event.

```{r}
#| label: tbl-ss-eventp
#| tbl-cap: "Recent soil-affecting events"

dat_ss_eventp <-
  tribble(~Code, ~Name,
          'MC', 'Mechanical disturbance (e.g. tillage, deep ripping)',
          'CL', 'Mechanical vegetation clearance (e.g. clearfelling)',
          'SL', 'Landslide event - soil lost from site',
          'SD', 'Landslide event - soil added to site',
          'WI', 'Wind-induced treefall',
          'FC', 'Fire - controlled burn',
          'FW', 'Fire - uncontrolled burn',
          'FL', 'Flooding - freshwater',
          'FS', 'Flooding - saline water (e.g. storm surge event)',
          'PO', 'Pollution event (e.g. petrol spill)',
          'NO', 'No recent events',
          'UK', 'Unknown')

tbl_ss_eventp <- gt(dat_ss_eventp) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20))

tbl_ss_eventp
```

## Explaining location

### Site choice method

Spatial sampling strategies vary in their statistical properties. Soil data is stored for long periods and is often re-used for multiple projects; specific re-uses may not be appropriate.

Record the spatial sampling strategy used using the schema in @tbl-ss-sampstrat. This parameter does not usually need to be recorded in the field.

```{r}
#| label: tbl-ss-sampstrat
#| tbl-cap: "Spatial sampling strategies"

dat_ss_sampstrat <-
  tribble(~Code, ~Name,
          'A', 'Arbitrary/opportunistic',
          'D', 'Data-driven',
          'M', 'Model-based',
          'R', 'Random',
          'T', 'Transect',
          'G', 'Grid')

tbl_ss_sampstrat <- gt(dat_ss_sampstrat) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20))

tbl_ss_sampstrat
```

The difference between data-driven [D]{.ceg} and model-based [M]{.ceg} centres around replicability. Data-driven sites are nominated using a loose set of rules or principles (e.g. “visit the major landforms on this farm but don’t go too far off the tracks”) and may be subject to minor changes once the worker is on-ground. Model-based site choices formalise this process with reference to specific input datasets, and the worker is committed to sample at the exact point chosen. Model-based methods may include ‘backup points’ for where an intended location cannot be physically accessed, but these are also pre-determined. Importantly, model-based choices can be regenerated from the same inputs.

Arbitrary [A]{.ceg} points are not pre-determined at all; rather, they are chosen after the worker is on site, in response to direct observation of on-ground conditions. These are often practical and time-efficient but are also likely to over-sample the more easily accessible and/or interesting parts of the landscape, to the detriment of overall representativeness.

Random, transect and grid sampling [R]{.ceg}, [T]{.ceg}, [G]{.ceg} effectively ignore environmental parameters. This is useful when the spatial distribution of a parameter of interest is unknown or poorly understood.

Some of these methods can be combined - for example, data-driven transect choices with randomised locations along each. In such cases, the 'last choice' should be recorded - in this case, [R]{.ceg}. The details of the full sampling strategy should be discussed in project metadata.

### Site purpose

The original task for which a site was observed can affect what data is recorded and is relevant to data re-use decisions.

Record the reason for sampling using the schema in @tbl-ss-reason. This parameter does not need to be recorded in the field.

```{r}
#| label: tbl-ss-reason
#| tbl-cap: "Site purpose"

dat_ss_reason <-
  tribble(~Code, ~Name,
          'E', 'Mapping exploration',
          'V', 'Mapping validation',
          'R', 'Research',
          'M', 'Monitoring',
          'T', 'Reference',
          'D', 'Development')

tbl_ss_reason <- gt(dat_ss_reason) |>
   tab_options(
    column_labels.font.weight = 'bold', 
    heading.title.font.weight = 'bold',
    table.align = 'center',
    table.width = '85%'
  ) |>
  tab_style(style = list(cell_text(color = 'red', weight = 'bold')),
            locations = cells_body(columns = 1)) |>
  cols_width(Code ~pct(20))

tbl_ss_reason
```

[D]{.ceg} sites are often carried out as part of planning for a resource consent. The soil they describe may be removed or sealed after observation, limiting data re-use potential. [M]{.ceg} monitoring sites imply repeated, regular re-sampling activity and perhaps an expectation of minimal major disturbance between visits.

[V]{.ceg} validation sites may be low-detail, as they are intended to confirm or deny a prediction. [T]{.ceg} reference sites (T for ‘type’) may be expected to have high morphological detail and a lot of accompanying analytical data, as they represent ‘ideal’ profiles for particular soil classes.

[E]{.ceg} mapping exploration sites may have biased, opportunistic sample locations and moderate location precision, while [R]{.ceg} sites are more likely to have been predetermined by a model and located with high precision.
